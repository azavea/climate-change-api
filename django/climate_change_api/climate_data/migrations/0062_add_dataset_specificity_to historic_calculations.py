# -*- coding: utf-8 -*-
# Generated by Django 1.10.7 on 2017-11-09 18:30
from __future__ import unicode_literals

import climate_data.models
from django.db import migrations
import django.db.models.deletion


def set_historic_dataset_as_nex(apps, schema_editor):
    ClimateDataset = apps.get_model('climate_data', 'ClimateDataset')
    HistoricAverageClimateDataYear = apps.get_model('climate_data', 'HistoricAverageClimateDataYear')
    ClimateDataBaseline = apps.get_model('climate_data', 'ClimateDataBaseline')

    nex_gddp = ClimateDataset.objects.get(name='NEX-GDDP')

    ClimateDataBaseline.objects.filter(dataset=1).update(dataset=nex_gddp)
    HistoricAverageClimateDataYear.objects.filter(dataset=1).update(dataset=nex_gddp)


class Migration(migrations.Migration):

    dependencies = [
        ('climate_data', '0061_fix_loca_model_list'),
    ]

    operations = [
        migrations.AddField(
            model_name='climatedatabaseline',
            name='dataset',
            field=climate_data.models.TinyForeignKey(blank=True, default=1, on_delete=django.db.models.deletion.CASCADE, to='climate_data.ClimateDataset'),
            preserve_default=False,
        ),
        migrations.AddField(
            model_name='historicaverageclimatedatayear',
            name='dataset',
            field=climate_data.models.TinyForeignKey(blank=True, default=1, on_delete=django.db.models.deletion.CASCADE, to='climate_data.ClimateDataset'),
            preserve_default=False,
        ),
        migrations.AlterUniqueTogether(
            name='climatedatabaseline',
            unique_together=set([('map_cell', 'percentile', 'historic_range', 'dataset')]),
        ),
        migrations.AlterUniqueTogether(
            name='historicaverageclimatedatayear',
            unique_together=set([('map_cell', 'historic_range', 'dataset')]),
        ),
        migrations.AlterIndexTogether(
            name='historicaverageclimatedatayear',
            index_together=set([('map_cell', 'historic_range', 'dataset')]),
        ),
        migrations.RunPython(set_historic_dataset_as_nex, migrations.RunPython.noop)
    ]
